---
title: "General Conference Quotes"
author: "Kameron York"
date: "2023-10-15"
output: 
  html_document:
    includes:
      in_header: "https://raw.githubusercontent.com/kameronyork/kameronyork.github.io/main/parables/header.html"
      after_body: "https://raw.githubusercontent.com/kameronyork/kameronyork.github.io/main/parables/footer.html"
---

```{r setup, include=FALSE}
library(tidyverse)
library(pander)
library(plotly)

quotes <- read.csv("https://www.kameronyork.com/datasets/conference-quotes.csv", encoding="UTF-8")
verses <- read.csv("https://www.kameronyork.com/datasets/scripture-verses.csv", encoding="UTF-8") %>% 
  mutate("book_chapter" = paste(book, chapter, sep = " ")) %>% 
  mutate("quoted" = case_when(
    scripture %in% quotes$combined_scripture ~ "Found",
    TRUE ~ ""
  ))

verse_order_data <- read.csv("https://www.kameronyork.com/datasets/verse-order.csv", encoding="UTF-8")
verse_order <- strsplit(verse_order_data$order, ", ") %>% 
  unlist()

```

## Overall Quotes Analysis
```{r}
total_by_year <- quotes %>% 
  group_by(year) %>% 
  summarise("total_quotes" = n())

ggplot(data = total_by_year) + 
  geom_area(mapping = aes(x = year, y = total_quotes), fill="steelblue", alpha=0.5) +
  labs(title="Total Quotes by Year",
       x = "Year", 
       y = "Total Scriptures Quoted") +
  theme_bw()
```
```{r}
book_by_year <- quotes %>% 
  group_by(sub_book, year) %>% 
  summarise("total_quotes" = n())

ggplot(data = book_by_year) + 
  geom_area(mapping = aes(x = year, y = total_quotes, fill = sub_book), position="identity", alpha = 0.5) +
  labs(title="Total Quotes by Book and Year",
       x = "Year", 
       y = "Total Scriptures Quoted per Book") +
  theme_bw()
```

```{r}
ggplot(data = book_by_year) + 
  geom_line(mapping = aes(x = year, y = total_quotes, color = sub_book), size=1) +
  labs(title="Total Quotes by Book and Year",
       x = "Year", 
       y = "Total Scriptures Quoted per Book") +
  theme_bw()
```

### What are the top 10 Scriptures of all time?
```{r}
all_time_10 <- quotes %>% 
  group_by(combined_scripture) %>% 
  summarise("count" = n()) %>% 
  arrange(desc(count)) %>% 
  mutate("rank" = rank(desc(count), ties.method = "max")) %>% 
  filter(rank %in% c(1:10))

history_all_time_10 <- quotes %>% 
  filter(combined_scripture %in% all_time_10$combined_scripture) %>% 
  mutate("decade" = paste(str_sub(year, 1, 3), 0, sep="")) %>% 
  group_by(decade)

pander(all_time_10)
```

```{r}
ggplot(data = history_all_time_10) + 
  geom_bar(mapping = aes(x = decade, fill = combined_scripture), size=1, position="dodge") +
  labs(title="Total Quotes Top 10 Scriptures all Time",
       x = "Year", 
       y = "Total Scriptures Quoted per Book") +
  theme_bw()
```
```{r}
line_all_time_history <- history_all_time_10 %>% 
  group_by(decade = as.numeric(decade), combined_scripture) %>% 
  summarise("count" = n())


ggplot(data = line_all_time_history) + 
  geom_line(mapping = aes(x = decade, y = count, color = combined_scripture), size=1) +
  labs(title="Total Quotes Top 10 Scriptures all Time",
       x = "Year", 
       y = "Total Scriptures Quoted per Book") +
  theme_bw()
```

#### Displaying them over time?



### What about in different decades?



### Creating a Grid:

```{r}
my_plot <- ggplot(data = verses, aes(x = verse, y = fct_rev(factor(book_chapter, levels = verse_order)), fill = quoted)) +
  geom_tile(col = "white") +
  coord_equal(ratio=2.33) +
  scale_fill_manual(values = c("NA" = "white", "Found" = "red")) +
  scale_x_continuous(breaks = unique(verses$verse)) + 
  theme_minimal() +
  theme(
    legend.position = "right",
    panel.background = element_rect(fill = "white"),
    axis.text.y = element_text(size = rel(0.5)),
    axis.text.x = element_blank(),
    axis.title.y = element_blank()
  ) + 
  guides(fill = "none")

ggsave(filename = "C:/Users/theka/Pictures/my_plot.png", plot = my_plot, width = 8, height = 120, units = "in", limitsize = FALSE, bg = "white")

```



```{r}
levels_check <- verses %>%
  select(book_chapter) %>% 
  mutate("check" = case_when(
    book_chapter %in% verse_order ~ "FOUND",
    TRUE ~ "NOT"
  ))


```

